<!doctype html>
<html>
	<head>
		<% include ../headerStuff %>
	</head>
	<body>
		<% include ../pageHeader %>
		<div class="container">

			<div class="card">
				<div class="card-header alert-info">
					<h2><span class="fa fa-tags">&nbsp; </span>Danh sách chủ đề</h2>
				</div>
				<div class="card-body">
					<table class="table table-sm table-hover">
						<thead class="thead-default">
							<tr>
								<th>ID</th>
								<th>Name</th>
								<th>Tag</th>
								<th>Action <a data-toggle="modal" data-target="#modalAddNew" href="#"><span class="fa text-success fa-plus color-success float-right mr-3"></span></a></th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th scope="row">1</th>
								<td>Mark</td>
								<td>mark@email.com</td>
								<td>
									<a class="m-2" data-toggle="modal" data-target="#modalEdit" href="#"><span class="fa fa-edit"></span></a>
									<a data-toggle="modal" data-target="#modalDelete" href="#"><span class="fa text-danger fa-trash-o"></span></a>
								</td>
							</tr>
							<tr>
								<th scope="row">2</th>
								<td>Jacob</td>
								<td>thornton@email.com</td>
								<td>
									<a class="m-2" data-toggle="modal" data-target="#modalEdit" href="#"><span class="fa fa-edit"></span></a>
									<a data-toggle="modal" data-target="#modalDelete" href="#"><span class="fa text-danger fa-trash-o"></span></a></td>
							</tr>
							<tr>
								<th scope="row">3</th>
								<td>Larry</td>
								<td>thebird@email.com</td>
								<td>
									<a class="m-2" data-toggle="modal" data-target="#modalEdit" href="#"><span class="fa fa-edit"></span></a>
									<a data-toggle="modal" data-target="#modalDelete" href="#"><span class="fa text-danger fa-trash-o"></span></a></td>
							</tr>
						</tbody>
					</table>  
				</div>
			</div>
			<div class="modal fade" id="modalAddNew" tabindex="-1" role="dialog" aria-labelledby="addNewModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="addNewModalLabel"><span class="fa fa-tag"></span>&nbsp;Thêm mới chủ đề</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<form action="/admin/category" id="formNewCategory" method="POST">
								<div class="form-group row">
									<div class="col-md-3 col-sm-0"></div>
									<div class="alert alert-danger col-md-6 col-sm-12" id="newCategoryInfo"></div>
								</div>
								<div class="form-group row">
									<label class="col-md-3 col-sm-0" for="name">Tên chủ đề:</label>
									<input class="col-md-6 col-sm-12" type="text" name="name" required="" title="Hãy nhập chủ đề" placeholder="Nhập chủ đề" oninvalid="this.setCustomValidity('Nhập tên chủ đề')" oninput="setCustomValidity('')" >
								</div>
									<div class="form-group row">
										<label class="col-md-3 col-sm-0" for="tag">Tag:</label>
										<input class="col-md-6 col-sm-12" type="text" name="tag">
									</div>
									<div class="form-group row">
										<div class="col-md-3 col-sm-0"></div>
										<div class="col-md-6 col-sm-12">
											<button class = "btn btn-danger" type="button" data-dismiss="modal">Hủy</button>
											<button class="btn ml-5 btn-success" type="submit"><span class="fa fa-tag"></span>&nbsp;Tạo</button>
										</div>
									</div>
							</form>

						</div>
						<!--
		  <div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		  <button type="button" class="btn btn-primary">Save changes</button>
		  </div>
						-->
					</div>
				</div>
			</div>
			<div class="modal fade" id="modalEdit" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="editModalLabel"><span class="fa fa-tag"></span>&nbsp;chỉnh sửa  chủ đề</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<form action="/admin/category" id="formEditCategory" method="POST">
								<div class="form-group row">
									<div class="col-md-3 col-sm-0"></div>
									<div class="alert alert-danger col-md-6 col-sm-12">Thông báo lỗi</div>
								</div>
								<div class="form-group row">
									<label class="col-md-3 col-sm-0" for="name">Tên chủ đề:</label>
									<input class="col-md-6 col-sm-12" type="text" name="name">
								</div>
								<div class="form-group row">
									<label class="col-md-3 col-sm-0" for="tag">Tag:</label>
									<input class="col-md-6 col-sm-12" type="text" name="tag">
								</div>
								<div class="form-group row">
									<div class="col-md-3 col-sm-0"></div>
									<div class="col-md-6 col-sm-12">
										<button class = "btn btn-danger" type="button" data-dismiss="modal">Hủy</button>
										<button class="btn ml-5 btn-success" type="submit"><span class="fa fa-tag"></span>&nbsp;Sửa</button>
									</div>
								</div>
							</form>

						</div>
						<!--
		  <div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		  <button type="button" class="btn btn-primary">Save changes</button>
		  </div>
						-->
					</div>
				</div>
			</div>
			<div class="modal fade" id="modalDelete" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="deleteModalLabel"><span class="fa fa-tag"></span>&nbsp;Xóa chủ đề</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<form action="/admin/category" id="formDeleteCategory" name="formNewCategory" method="POST">
								<div class="form-group row">
									<div class="col-md-3 col-sm-0"></div>
									<div class="alert alert-danger col-md-6 col-sm-12">Thông báo lỗi</div>
								</div>
								<div class="form-group row">
									<label class="col-md-3 col-sm-0" for="newname">Tên chủ đề:</label>
									<input class="col-md-6 col-sm-12" type="text" name="name">
								</div>
								<div class="form-group row">
									<label class="col-md-3 col-sm-0" for="tag">Tag:</label>
									<input class="col-md-6 col-sm-12" type="text" name="tag">
								</div>
								<div class="form-group row">
									<div class="col-md-3 col-sm-0"></div>
									<div class="col-md-6 col-sm-12">
										<button class = "btn btn-danger" type="button" data-dismiss="modal">Hủy</button>
										<button class="btn ml-5 btn-success" type="submit"><span class="fa fa-tag"></span>&nbsp;Xóa</button>
									</div>
								</div>
							</form>

						</div>
						<!--
		  <div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		  <button type="button" class="btn btn-primary">Save changes</button>
		  </div>
						-->
					</div>
				</div>
			</div>
		</div>
		<% include ../pageFooter %>
		<% include ../footerStuff %>
		<script>
$(document).ready(function(){
	var inputName = $('#formNewCategory :input[name="name"]'); 
	var inputTag = $('#formNewCategory :input[name="tag"]'); 
	var txtInfo = $('#newCategoryInfo');
	txtInfo.hide();
	//Handler new category modal when show
	$('#modalAddNew').on('shown.bs.modal', function () {
		inputName.focus();
	})

	//Handler new category modal when hide 
	$('#modalAddNew').on('hidden.bs.modal', function () {
		txtInfo.text("");
		txtInfo.hide();
		inputName.val('');
		inputTag.val('');
	})
	inputName.focus(function(){
		txtInfo.hide();
	});
	inputTag.focus(function(){
		txtInfo.hide();
	});
	/*
	inputName.change(function(){
		txtInfo.text('');
		txtInfo.hide();
	});
	inputTag.change(function(){
		txtInfo.text('');
		txtInfo.hide();
	});
	*/
	inputName.blur(function(){
		if($(this).val().length > 3){
			let tag = KhongDau(inputName.val(),["chuyen","url"]);
			inputTag.val(tag);
		}
	});

	//process submit form add new category here
	$('#formNewCategory').submit(function(event){
		let okSubmit = true;
		//process submit form here	
		//again validate form
		if(inputName.val().length < 3){
			txtInfo.text("Tên chủ đề phải > 3 ký tự");
			txtInfo.show();
			okSubmit = false;
		}
		if(inputTag.val().lenth <= 0){
			txtInfo.text("Tag phải > 3 ký tự");		
			txtInfo.show();
			okSubmit = false;
		}
		$.get(encodeURI("/admin/checkcategory/"+inputName.val()),function(data){
			//alert(data);
			if(data=="exist"){
				//alert("Thông báo lỗi");
				txtInfo.text("Đã có chủ đề này");
				txtInfo.show();
				okSubmit = false;
			}else if(data == "error"){
				//co loi xay ra thu lai sau
				txtInfo.text("Có lỗi xảy ra. Thử lại");
				txtInfo.show();
				okSubmit = false;	
			}else if(data == "ok"){
				if(okSubmit){
					//ajax submit here
					$.post('/admin/category',{name: inputName.val(), tag: inputTag.val()}, function(data){
						alert("submit result:"+data);
						if(data=="ok"){
							txtInfo.removeClass("alert-danger").addClass("alert-success");
							txtInfo.text("Tạo thành công !");
							txtInfo.show();
						}else{
							txtInfo.text("Có lỗi xảy ra. Thử lại");
							txtInfo.show();
						}
					});
				}

			}
		});
		event.preventDefault();
	});
});
		</script>
	</body>
</html>
